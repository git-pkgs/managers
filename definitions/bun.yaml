# Bun - Fast JavaScript runtime and package manager
# https://bun.sh/
#
# Bun uses package.json for manifests and bun.lock (text) or bun.lockb (binary)
# for lockfiles. It's npm-compatible but significantly faster.

name: bun
ecosystem: npm
binary: bun
version: ">=1.0.0"

detection:
  lockfiles:
    - bun.lock
    - bun.lockb
  manifests:
    - package.json
  priority: 25  # Higher than npm/yarn/pnpm when bun lockfile present

commands:
  install:
    base: [install]
    flags:
      frozen: [--frozen-lockfile]
      dev: []  # dev is default
      production: [--production]
      force: [--force]
    capabilities:
      frozen_lockfile: true

  add:
    base: [add]
    args:
      package:
        position: 0
        required: true
        validate: npm_package
    flags:
      dev: [--dev]
      optional: [--optional]
      peer: [--peer]
      exact: [--exact]
      global: [--global]

  remove:
    base: [remove]
    args:
      package:
        position: 0
        required: true
    flags:
      global: [--global]

  list:
    base: [pm, list]
    flags:
      all: [--all]

  outdated:
    base: [outdated]
    flags:
      recursive: [--recursive]

  update:
    base: [update]
    args:
      package:
        position: 0
        required: false
    flags:
      latest: [--latest]
      dry_run: [--dry-run]
      recursive: [--recursive]

  # bun packages are in node_modules/<package>
  path:
    base: [pm, ls]
    args:
      package: {position: 0, required: true, validate: npm_package, extraction_only: true}
    exit_codes:
      0: success
      1: error
    extract:
      type: template
      pattern: "node_modules/{package}"

  resolve:
    base: [pm, ls]
    default_flags: [--all]
    exit_codes:
      0: success
      1: error

capabilities:
  - install
  - install_frozen
  - add
  - add_dev
  - add_optional
  - remove
  - list
  - outdated
  - update
  - path
  - resolve
